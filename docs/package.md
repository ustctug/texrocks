# Package

Except
[How to publish a Lua project](https://nvim-neorocks.github.io/guides/publishing/),
you should know:

## Version

Many TeX projects publish TeX package in CTAN or Github/Gitlab release if they
have a git repository. Github release can tag version while CTAN cannot. Such as:

- <https://github.com/latex3/latex2e/releases/download/release-2024-11-01-PL2/latex-graphics.tds.zip>
  is for version 2024-11-01, we package it to 2024.11.01-1
- <http://mirrors.ctan.org/install/macros/latex/contrib/hyperref.tds.zip>
  is for latest version. we package it to scm-1

Version is good to declare dependency relationship. We recommend stable version
rather than source code managed version.

## Formats

TeX packages have two formats:

- source package `*-ctan.zip`, like:
  - lua: `*.src.rock`
  - python : sdist `*.tar.gz`
- binary package `*.tds.zip`, like:
  - lua: `*.any.rock`, `*.win-x86_64.rock`
  - python: `*-any.whl`, `*-win_amd64.whl`

Like converting typescript to javascript, we need convert `*-ctan.zip`'s `*.dts`
and `*.ins` to `*.tds.zip`'s `*.cls` and `*.sty`. We package `*.tds.zip` to skip
converting, like `npmjs.org` packages only contain `*.js` not `*.ts`.

We repackage `*.tds.zip` to `*.src.rock` in order to upload them to luarocks.org.

## Dependencies

`*.tds.zip` doesn't have meta information about packages. when we create
`*.rockspec`, we need to add it from [CTAN](https://ctan.org/).

CTAN doesn't provide dependence information. You need search it. e.g.,

`tex/latex/base/ltnews.cls`:

```tex
% ...
\IfFileExists{hyperref.sty}{%
  \RequirePackage[hidelinks]{hyperref}}{}
% ...
```

`hyperref` is an optional dependency of `latex-base`.

## Build Dependencies

Some TeX packages don't provide `*.tds.zip`. You have to build it from
`*.ctan.zip`.

```sh
lualatex --interaction=nonstopmode foo.ins
```

or:

```sh
l3build ctan
```

add `{ 'texrocks', 'lualatex', 'latex-base' }` or `{ 'l3build', 'latex-base' }` to
`build_dependencies`.

## TeX Dialect

`lualatex` is a wrapper of `luatex --fmt=lualatex.fmt`. `lualatex.fmt` is
generated by `lualatex.ini`, a TeX file. See `XXX-build-environment` to know
how to build.

## TeX Tools

All TeX tools written in lua use texlua as interpreter. We use luahbtex, which is
a lua 5.3 interpreter and support [harfbuzz](https://harfbuzz.github.io/).
See [texdoc](https://texdoc.org/serve/luatex/0) to know more.
